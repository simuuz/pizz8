#pragma once
#include "common.h"

class Emu {
public:
    Emu();
    void load(std::string filename);
    void execute(SDL_Event* event);
    void input(SDL_Event* event, bool& quit);
    bool draw = false;
    bool idle = false;
    void reset();
    std::array<Color, 64 * 32> display;
private:
    void _00kk(u16 kk);
    void _8xyn(u8 x, u8 y, u8 n);
    void dxyn(u8 x, u8 y, u8 n);
    void fxkk(u8 x, u16 kk);
    u16 pc = 0x200, I = 0;
    std::array<u8, 16> v; u8 sp = 0, delay = 0, sound = 0;
    std::array<u16, 16> stack;
    std::array<u8, 16> key;
    std::array<u8, 4096> mem;
    const u8 font[16 * 5] = {
        0xF0,0x90,0x90,0x90,0xF0,   // 0
        0x20,0x60,0x20,0x20,0x70,   // 1
        0xF0,0x10,0xF0,0x80,0xF0,   // 2
        0xF0,0x10,0xF0,0x10,0xF0,   // 3
        0x90,0x90,0xF0,0x10,0x10,   // 4
        0xF0,0x80,0xF0,0x10,0xF0,   // 5
        0xF0,0x80,0xF0,0x90,0xF0,   // 6
        0xF0,0x10,0x20,0x40,0x40,   // 7
        0xF0,0x90,0xF0,0x90,0xF0,   // 8
        0xF0,0x90,0xF0,0x10,0xF0,   // 9
        0xF0,0x90,0xF0,0x90,0x90,   // A
        0xE0,0x90,0xE0,0x90,0xE0,   // B
        0xF0,0x80,0x80,0x80,0xF0,   // C
        0xE0,0x90,0x90,0x90,0xE0,   // D
        0xF0,0x80,0xF0,0x80,0xF0,   // E
        0xF0,0x80,0xF0,0x80,0x80    // F
    };
};
